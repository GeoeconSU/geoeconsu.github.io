<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global RAO Heatmap | GSU</title>
    
    <link rel="icon" type="image/x-icon" href="gsu.ico">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary-bg: #192030;
            --secondary-bg: #1f283b;
            --text-white: #ffffff;
            --accent-gold: #cba84e;
            --bright-gray: #eeeeee;
            --font-head: 'Playfair Display', serif;
            --font-body: 'EB Garamond', serif;
            --easing: cubic-bezier(0.23, 1, 0.32, 1);
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--primary-bg);
            color: var(--text-white);
            font-family: var(--font-body);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, h4 { font-family: var(--font-head); font-weight: 400; }
        
        h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            position: relative;
            display: inline-block;
        }

        h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 40px;
            height: 1px;
            background-color: var(--accent-gold);
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-white);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
            display: inline-block;
        }

        h4 {
            font-size: 1.1rem;
            color: var(--accent-gold);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        /* Layout Utilities */
        .container { max-width: 1280px; margin: 0 auto; padding: 0 2rem; position: relative; z-index: 2; }
        
        .header-content {
            text-align: center;
            max-width: 900px;
            margin: 0 auto 3rem auto;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        /* Text Styling */
        p {
            font-size: 1.15rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        a { text-decoration: none; color: inherit; transition: 0.3s ease; }

        /* Navigation */
        nav {
            padding: 2rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(25, 32, 48, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .logo img { height: 50px; width: auto; display: block; }
        .nav-links a { font-family: var(--font-head); font-size: 0.9rem; letter-spacing: 1px; margin-left: 2rem; opacity: 0.7; }
        .nav-links a:hover { opacity: 1; color: var(--accent-gold); }

        /* Map Section */
        #map-header { padding-top: 150px; padding-bottom: 3rem; }

        #map-container {
            width: 100%;
            aspect-ratio: 2 / 1; 
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 4rem;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        /* Definition Cards */
        .regime-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-left: 3px solid var(--accent-gold);
        }

        .regime-title {
            color: var(--accent-gold);
            font-family: var(--font-head);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* --- Custom Map Styling --- */
        div.google-visualization-tooltip {
            background-color: var(--secondary-bg) !important;
            border: 1px solid var(--accent-gold) !important;
            border-radius: 4px !important;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5) !important;
            padding: 0 !important;
            z-index: 1000 !important;
            visibility: visible !important; 
            opacity: 1 !important;
        }

        .tooltip-custom {
            font-family: var(--font-body);
            color: white;
            padding: 1rem 1.2rem;
            min-width: 200px;
        }

        .tooltip-title {
            font-family: var(--font-head);
            font-size: 1.3rem;
            color: var(--accent-gold);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
            margin-bottom: 0.8rem;
        }

        .tooltip-row { font-size: 1rem; margin: 5px 0; display: flex; justify-content: space-between; }
        .tooltip-row strong { opacity: 0.6; font-weight: 400; margin-right: 1rem; }

        /* Hover Outline */
        #regions_div svg g g path {
            transition: stroke 0.1s ease, stroke-width 0.1s ease;
            stroke: #1f283b; 
            stroke-width: 1px;
        }

        #regions_div svg g g path:hover {
            stroke: var(--bright-gray) !important; 
            stroke-width: 2px !important;
            fill-opacity: 1 !important;
            z-index: 999;
        }

        /* Button */
        .btn {
            display: inline-block;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 1rem 2.5rem;
            font-family: var(--font-head);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.15em;
            margin-top: 1rem;
            transition: all 0.4s var(--easing);
            background: transparent;
            color: white;
            cursor: pointer;
        }

        .btn:hover {
            border-color: var(--accent-gold);
            background: rgba(203, 168, 78, 0.1);
        }

        /* Footer */
        footer { padding: 5rem 0; background: #151a28; font-size: 0.95rem; margin-top: auto; }
        .footer-grid { display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 3rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 3rem; }

        @media (max-width: 900px) {
            .nav-links { display: none; }
            #map-container { height: 50vh; aspect-ratio: auto; }
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <nav class="container">
        <div class="logo">
            <a href="index.html"><img src="gsu.png" alt="GSU Logo"></a>
        </div>
        <div class="nav-links">
            <a href="index.html#about">About</a>
            <a href="index.html#barometer">Barometer</a>
            <a href="index.html#services">Services</a>
            <a href="index.html#rao-engine">RAO Engine</a>
            <a href="index.html#team">Our Team</a>
            <a href="mailto:geoecon@16thcouncil.uk">Contact</a>
        </div>
    </nav>

    <section class="container" id="map-header">
        <div class="header-content fade-up">
            <h4>Live Intelligence</h4>
            <h2>Global RAO Heatmap</h2>
            <p>
                Interactive visualization of our Risk-Adjusted Opportunity scores. 
                Darker regions indicate structural risks, while gold highlights areas of high opportunity.
                Hover over a country to view its specific regime classification.
            </p>
        </div>

        <div id="map-container">
            <div id="regions_div" style="width: 100%; height: 100%;"></div>
        </div>

        <div class="fade-up" style="max-width: 1000px; margin: 0 auto 4rem auto;">
            <h3>Regime Classifications</h3>
            <p>Countries are classified into RAO regimes based on their level of opportunity (measured by the mean RAO score) and the stability of outcomes (measured by volatility and downside risk). There are four primary regimes:</p>
            
            <div class="grid-2">
                <div class="regime-card">
                    <span class="regime-title">Robust Opportunity</span>
                    <p style="margin-bottom:0; font-size:1rem;">Countries with positive mean scores and low volatility. Opportunity is high and outcomes are stable.</p>
                </div>
                <div class="regime-card">
                    <span class="regime-title">Fragile Opportunity</span>
                    <p style="margin-bottom:0; font-size:1rem;">Countries with high mean scores but elevated volatility or downside risk. Opportunity exists but is exposed to shocks.</p>
                </div>
                <div class="regime-card">
                    <span class="regime-title">Stable but Low Opportunity</span>
                    <p style="margin-bottom:0; font-size:1rem;">Countries with low volatility but weak or negative mean scores. Conditions are stable but growth potential is limited.</p>
                </div>
                <div class="regime-card">
                    <span class="regime-title">Structural Risk</span>
                    <p style="margin-bottom:0; font-size:1rem;">Countries with negative mean scores and material downside risk. Fragility dominates opportunity.</p>
                </div>
            </div>

            <p style="font-size: 0.95rem; opacity: 0.6; font-style: italic;">
                Note: Countries are slotted into regimes using thresholds derived from the empirical distribution of scores rather than fixed global cut-offs. This allows the classification to adapt as the global environment changes.
            </p>
        </div>

        <div style="text-align: center;">
            <a href="index.html" class="btn">Return to Home</a>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div>
                    <strong style="color:var(--accent-gold); text-transform:uppercase; letter-spacing:1px;">The Sixteenth Council</strong><br>
                    <span style="opacity:0.7;">Office 5336<br>182-184 High Street North<br>East Ham London, E6 2JA<br>United Kingdom</span>
                </div>
                <div style="text-align: right;">
                    <a href="mailto:geoecon@16thcouncil.uk" style="border-bottom: 1px solid var(--accent-gold);">geoecon@16thcouncil.uk</a><br>
                    <span style="opacity:0.7;">+44 7881 1644457</span><br>
                    <a href="http://www.16thcouncil.uk" target="_blank" style="opacity:0.7;">www.16thcouncil.uk</a>
                </div>
            </div>
            <div style="margin-top: 2rem; opacity: 0.4; font-size: 0.8rem; text-align: center;">
                &copy; 2025 Sixteenth Council Geoeconomic Strategic Unit. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script type="text/javascript">
        // 1. Initialize Google Charts
        google.charts.load('current', {
            'packages':['geochart']
        });

        google.charts.setOnLoadCallback(fetchDataAndDraw);

        // 2. Fetch CSV Data
        async function fetchDataAndDraw() {
            try {
                const response = await fetch('rao2.csv');
                if (!response.ok) throw new Error('Failed to load CSV data');
                
                const csvText = await response.text();
                parseCSVAndDraw(csvText);
                
            } catch (error) {
                console.error('Error loading map data:', error);
                document.getElementById('regions_div').innerHTML = 
                    '<p style="text-align:center; padding-top:20%; opacity:0.6;">Unable to load map data. Please ensure rao.csv is available.</p>';
            }
        }

        // 3. Name Normalizer
        function normalizeCountryName(name) {
            const mapping = {
                "Russian Federation": "Russia",
                "Korea, Rep.": "South Korea",
                "Egypt, Arab Rep.": "Egypt",
                "Iran, Islamic Rep.": "Iran",
                "Slovak Republic": "Slovakia",
                "Congo, Dem. Rep.": "Democratic Republic of the Congo",
                "Congo, Rep.": "Republic of the Congo",
                "Yemen, Rep.": "Yemen",
                "Venezuela, RB": "Venezuela",
                "Syrian Arab Republic": "Syria",
                "Kyrgyz Republic": "Kyrgyzstan",
                "Lao PDR": "Laos",
                "Bahamas, The": "The Bahamas",
                "Gambia, The": "The Gambia",
                "Turkiye": "Turkey",
                "Viet Nam": "Vietnam",
                "Brunei Darussalam": "Brunei"
            };
            return mapping[name] || name;
        }

        // 4. Parse CSV
        function parseCSVAndDraw(csvText) {
            
            // Clean specific artifacts 
            const sourcePattern = new RegExp('(\\r\\n|\\n|\\r)\\\\s*', 'g');
            let cleanText = csvText.replace(sourcePattern, " ");

            const startPattern = new RegExp('^\\\\s*', 'g');
            cleanText = cleanText.replace(startPattern, "");
            
            const rows = cleanText.trim().split(/\r?\n/);
            const dataTable = new google.visualization.DataTable();
            
            dataTable.addColumn('string', 'Country');
            dataTable.addColumn('number', 'RAO Score');
            dataTable.addColumn({type: 'string', role: 'tooltip', p: {html: true}});

            const csvRegex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;

            for (let i = 1; i < rows.length; i++) {
                let row = rows[i];
                if (!row || row.trim() === '') continue;

                let columns = row.split(csvRegex);
                if (columns.length < 2) continue;

                let rawName = columns[0] ? columns[0].replace(/^"|"$/g, '').trim() : '';
                let score = columns[1] ? parseFloat(columns[1]) : 0;
                let regime = columns[2] ? columns[2].replace(/^"|"$/g, '').trim() : '';

                if (rawName === '' || isNaN(score)) continue;

                // Normalize name for Google to match "Russian Federation" -> "Russia"
                let countryName = normalizeCountryName(rawName);

                dataTable.addRow([
                    countryName,
                    score,
                    createCustomTooltip(rawName, score, regime)
                ]);
            }

            drawMap(dataTable);
        }

        // 5. Tooltip Generator
        function createCustomTooltip(country, score, regime) {
            return `
                <div class="tooltip-custom">
                    <div class="tooltip-title">${country}</div>
                    <div class="tooltip-row"><strong>RAO Score:</strong> ${score}</div>
                    <div class="tooltip-row"><strong>Regime:</strong> ${regime}</div>
                </div>
            `;
        }

        // 6. Draw Map
        function drawMap(data) {
            var options = {
                magnifyingGlass: { enable: false, zoomFactor: 7.5 },
                keepAspectRatio: true,
                
                colorAxis: {
                    colors: ['#2e3b55', '#4d5d7e', '#cba84e'], 
                    minValue: 0,
                    maxValue: 10
                },
                
                backgroundColor: '#192030', 
                datalessRegionColor: '#252e42',
                
                chartArea: { left: 0, top: 0, width: '100%', height: '100%' }, 
                
                legend: {
                    textStyle: { 
                        color: '#ffffff', 
                        fontName: 'EB Garamond', 
                        fontSize: 14,
                        bold: false
                    }
                },
                
                tooltip: { 
                    isHtml: true, 
                    showTitle: false 
                }
            };

            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
            chart.draw(data, options);
        }

        window.addEventListener('resize', () => {
            fetchDataAndDraw();
        });
    </script>
</body>
</html>
